<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QWEN 2.5 VLM INTERFACE MK-VII</title>
    <link href="https://fonts.googleapis.com/css2?family=Rajdhani:wght@500;600;700;800&family=Orbitron:wght@900&display=swap" rel="stylesheet">
    <style>
        /* --- CORE VARIABLES --- */
        :root {
            --neon-gold: #ffd700;
            --neon-red: #ff003c;
            --tech-black: #050505;
            --glass: rgba(10, 0, 0, 0.9);
            --ease-out: cubic-bezier(0.23, 1, 0.32, 1);
        }

        * { box-sizing: border-box; }

        body {
            margin: 0; height: 100vh; background-color: var(--tech-black);
            font-family: 'Rajdhani', sans-serif; color: white;
            display: flex; justify-content: center; align-items: center; overflow: hidden;
        }

        /* --- BACKGROUND FX --- */
        .bg-mesh {
            position: absolute; width: 200%; height: 200%;
            background-image: linear-gradient(rgba(255, 0, 60, 0.05) 1px, transparent 1px),
                linear-gradient(90deg, rgba(255, 0, 60, 0.05) 1px, transparent 1px);
            background-size: 60px 60px; transform: perspective(500px) rotateX(60deg) translateY(-100px) translateZ(-200px);
            animation: gridMove 20s linear infinite; z-index: 0; pointer-events: none;
        }
        .vignette {
            position: absolute; width: 100%; height: 100%;
            background: radial-gradient(circle, transparent 20%, #000 100%); z-index: 1; pointer-events: none;
        }

        /* --- MAIN DASHBOARD CONTAINER --- */
        .holodeck {
            position: relative; z-index: 10; width: 95vw; height: 92vh;
            background: var(--glass); backdrop-filter: blur(10px); border: 1px solid var(--neon-red);
            clip-path: polygon(40px 0, calc(100% - 40px) 0, 100% 40px, 100% calc(100% - 40px), calc(100% - 40px) 100%, 40px 100%, 0 calc(100% - 40px), 0 40px);
            padding: 30px 40px; box-shadow: 0 0 60px rgba(255, 0, 60, 0.15);
            display: flex; flex-direction: column;
        }
        .holodeck::before { content: ''; position: absolute; top: 0; left: 10%; right: 10%; height: 3px; background: var(--neon-gold); box-shadow: 0 0 10px var(--neon-gold); z-index: 11; }
        .holodeck::after { content: ''; position: absolute; bottom: 0; left: 30%; right: 30%; height: 3px; background: var(--neon-gold); box-shadow: 0 0 10px var(--neon-gold); z-index: 11; }

        /* --- HEADER --- */
        .hud-header { text-align: center; margin-bottom: 20px; border-bottom: 1px solid rgba(255, 0, 60, 0.3); padding-bottom: 15px; flex-shrink: 0; }
        .main-title { font-family: 'Orbitron', sans-serif; font-size: clamp(1.5rem, 3vw, 2.5rem); margin: 0; letter-spacing: 6px; color: white; text-shadow: 2px 2px 0px var(--neon-red); text-transform: uppercase; }

        /* --- CONTENT GRID --- */
        .dashboard-grid {
            display: grid; grid-template-columns: 40% 60%; gap: 40px; height: 100%; overflow: hidden; position: relative;
        }
        .dashboard-grid::after { content: ''; position: absolute; left: 40%; top: 5%; bottom: 5%; width: 1px; background: linear-gradient(to bottom, transparent, var(--neon-red), transparent); opacity: 0.3; }

        /* --- LEFT COL: VISUALIZER --- */
        .reactor-stage { position: relative; width: 100%; height: 100%; display: flex; justify-content: center; align-items: center; }
        .spinner-ring { position: absolute; width: 80%; height: auto; aspect-ratio: 1/1; border: 2px dashed rgba(255, 215, 0, 0.2); border-radius: 50%; animation: spin 30s linear infinite; }
        .progress-svg { width: 70%; height: auto; transform: rotate(-90deg); filter: drop-shadow(0 0 15px var(--neon-gold)); z-index: 5; }
        .track { stroke: rgba(255, 0, 60, 0.05); }
        .fill { stroke: var(--neon-gold); stroke-linecap: round; transition: stroke-dashoffset 2s var(--ease-out); }
        .core-data { position: absolute; text-align: center; z-index: 6; }
        .val-display { font-family: 'Orbitron', sans-serif; font-size: 8rem; color: white; text-shadow: 0 0 20px var(--neon-gold); line-height: 1; }
        .currency-label { color: var(--neon-red); font-size: 1rem; letter-spacing: 5px; font-weight: 700; margin-top: 10px; }

        /* --- RIGHT COL: CONTROLS --- */
        .control-panel { padding: 5px 40px; display: flex; flex-direction: column; justify-content: center; height: 100%; overflow-y: auto; }
        .input-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 25px; }
        .span-2 { grid-column: span 2; }

        .input-label { display: flex; justify-content: space-between; color: var(--neon-gold); font-size: 0.8rem; letter-spacing: 2px; margin-bottom: 8px; text-transform: uppercase; font-weight: 600; }

        /* STANDARD INPUTS & SELECTS */
        .tech-input, .tech-select {
            width: 100%; background: rgba(0,0,0,0.5);
            border: 1px solid #444; border-left: 3px solid var(--neon-red);
            padding: 12px; color: #fff;
            font-family: 'Rajdhani', sans-serif; font-size: 1.1rem; font-weight: 600;
            text-transform: uppercase; outline: none; transition: all 0.3s;
        }
        .tech-input:focus, .tech-select:focus { border-color: var(--neon-gold); background: rgba(255, 215, 0, 0.1); }
        
        /* Style the dropdown arrow for select */
        .tech-select {
            appearance: none; -webkit-appearance: none; -moz-appearance: none;
            background-image: url("data:image/svg+xml;charset=US-ASCII,%3Csvg%20xmlns%3D%27http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%27%20width%3D%27292.4%27%20height%3D%27292.4%27%3E%3Cpath%20fill%3D%27%23ffd700%27%20d%3D%27M287%2069.4a17.6%2017.6%200%200%200-13-5.4H18.4c-5%200-9.3%201.8-13%205.4A17.6%2017.6%200%200%200%200%2087.2c0%205%201.8%209.3%205.4%2013l128%20128c3.6%203.6%207.8%205.4%2013%205.4s9.3-1.8%2013-5.4l128-128c3.6-3.6%205.4-7.8%205.4-13%200-5-1.8-9.3-5.4-13z%27%2F%3E%3C%2Fsvg%3E");
            background-repeat: no-repeat; background-position: right 15px top 50%; background-size: 12px auto; padding-right: 40px;
        }
        .tech-select option { background-color: var(--tech-black); color: white; }

        /* AGE SLIDER */
        .range-container { position: relative; width: 100%; padding: 10px 0; }
        input[type=range] { -webkit-appearance: none; width: 100%; background: transparent; }
        input[type=range]::-webkit-slider-thumb { -webkit-appearance: none; height: 20px; width: 20px; background: var(--neon-red); border: 2px solid white; cursor: pointer; margin-top: -8px; box-shadow: 0 0 10px var(--neon-red); }
        input[type=range]::-webkit-slider-runnable-track { width: 100%; height: 4px; background: #333; border: 1px solid #555; }

        /* FILE PREVIEW & UPLOAD */
        .file-slot {
            position: relative; height: 150px;
            background: rgba(255, 0, 60, 0.05); border: 1px dashed var(--neon-red);
            display: flex; justify-content: center; align-items: center;
            cursor: pointer; transition: all 0.3s; overflow: hidden;
            background-size: cover; background-position: center;
        }
        .file-slot:hover { background-color: rgba(255, 0, 60, 0.15); }
        .slot-text { color: var(--neon-red); font-weight: 700; font-size: 0.9rem; letter-spacing: 2px; z-index: 2; }
        
        /* Class added via JS when image is loaded */
        .preview-active .slot-text { display: none; }
        .preview-active { border-style: solid; border-color: var(--neon-gold); box-shadow: inset 0 0 20px rgba(0,0,0,0.5); }

        /* BUTTON */
        .arm-btn {
            width: 100%; padding: 20px; background: linear-gradient(90deg, #8b0000 0%, #ff0000 100%);
            border: none; color: white; font-family: 'Orbitron', sans-serif; font-size: 1.2rem; letter-spacing: 4px;
            cursor: pointer; clip-path: polygon(20px 0, 100% 0, 100% calc(100% - 20px), calc(100% - 20px) 100%, 0 100%, 0 20px);
            transition: all 0.2s; text-transform: uppercase;
        }
        .arm-btn:hover { box-shadow: 0 0 30px var(--neon-red); letter-spacing: 6px; }

        @keyframes spin { 100% { transform: rotate(360deg); } }
        @keyframes gridMove { 100% { transform: perspective(500px) rotateX(60deg) translateY(0) translateZ(-200px); } }

        @media (max-width: 1000px) {
            .dashboard-grid { grid-template-columns: 1fr; overflow-y: scroll; display: block; }
            .holodeck { height: auto; min-height: 100vh; width: 100%; border: none; padding: 20px; clip-path: none; }
            .reactor-stage { height: 350px; margin-bottom: 30px; }
            .dashboard-grid::after { display: none; }
            .input-grid { grid-template-columns: 1fr; }
            .span-2 { grid-column: span 1; }
        }
    </style>
</head>
<body>

    <div class="bg-mesh"></div>
    <div class="vignette"></div>

    <div class="holodeck">
        
        <header class="hud-header">
            <h1 class="main-title">Qwen 2.5 VLM Predictor MK-VII</h1>
        </header>

        <div class="dashboard-grid">
            
            <div class="reactor-stage">
                <div class="spinner-ring"></div>
                <svg class="progress-svg" viewBox="0 0 220 220">
                    <circle class="track" cx="110" cy="110" r="100" stroke-width="4" fill="transparent"/>
                    <circle class="fill" cx="110" cy="110" r="100" stroke-width="8" fill="transparent"/>
                </svg>
                <div class="core-data">
                    <div class="val-display" id="price-output">000</div>
                    <div class="currency-label">INR /// EST. VALUE</div>
                </div>
            </div>

            <div class="control-panel">
                <div class="input-grid">
                    
                    <div class="tech-input-group span-2">
                        <span class="input-label">Object Designation</span>
                        <input type="text" id="obj-name" class="tech-input" placeholder="e.g. Sony WH-1000XM4" autocomplete="off">
                    </div>

                    <div class="tech-input-group">
                        <span class="input-label">Category Class</span>
                        <select id="obj-category" class="tech-select">
                            <option value="" disabled selected>SELECT CLASS...</option>
                            <option value="electronics">Electronics & Gadgets</option>
                            <option value="computers">Computers & Peripherals</option>
                            <option value="smartphones">Smartphones & Tablets</option>
                            <option value="furniture">Furniture & Home</option>
                            <option value="appliances">Major Appliances</option>
                            <option value="fashion">Fashion & Accessories</option>
                            <option value="collectibles">Collectibles & Art</option>
                            <option value="vehicles">Vehicles & Parts</option>
                            <option value="other">Other / Unclassified</option>
                        </select>
                    </div>

                     <div class="tech-input-group">
                        <span class="input-label">Physical Condition</span>
                        <input type="text" id="obj-condition" class="tech-input" placeholder="e.g. Mint, Scratched..." autocomplete="off">
                    </div>

                    <div class="tech-input-group span-2">
                        <span class="input-label">
                            <span>Usage Duration</span>
                            <span class="slider-val" id="age-display">0 YRS</span>
                        </span>
                        <div class="range-container">
                            <input type="range" id="obj-age" min="0" max="10" step="0.5" value="0">
                        </div>
                    </div>

                    <div class="tech-input-group span-2">
                        <span class="input-label">Visual Scan Data</span>
                        <label for="img-file" class="file-slot" id="file-ui">
                            <span class="slot-text" id="slot-msg">+ INITIATE UPLOAD</span>
                        </label>
                        <input type="file" id="img-file" accept="image/*" style="display:none;">
                    </div>
                </div>

                <button id="predict-trigger" class="arm-btn">RUN DIAGNOSTIC & PREDICT</button>
            </div>

        </div>
    </div>

<script>
    /* --- CONFIG --- */
    const SERVER_URL = "https://excogitable-astrictively-tanisha.ngrok-free.dev"; 
    const MAX_VAL = 10000; 

    /* --- DOM NODES --- */
    const triggerBtn = document.getElementById('predict-trigger');
    const nameField = document.getElementById('obj-name');
    const catField = document.getElementById('obj-category'); // NEW
    const condField = document.getElementById('obj-condition');
    const ageField = document.getElementById('obj-age');
    const ageDisplay = document.getElementById('age-display');
    const fileField = document.getElementById('img-file');
    const fileUi = document.getElementById('file-ui');
    const slotMsg = document.getElementById('slot-msg');
    const priceOut = document.getElementById('price-output');
    const ring = document.querySelector('.fill');

    /* --- GAUGE INIT --- */
    const radius = ring.r.baseVal.value;
    const circumference = 2 * Math.PI * radius;
    ring.style.strokeDasharray = `${circumference} ${circumference}`;
    ring.style.strokeDashoffset = circumference;

    function setGauge(percent) {
        const offset = circumference - (percent * circumference);
        ring.style.strokeDashoffset = offset;
    }

    /* --- SLIDER LOGIC --- */
    ageField.addEventListener('input', (e) => {
        const val = e.target.value;
        ageDisplay.textContent = val + (val == 10 ? "+ YRS" : " YRS");
        ageDisplay.style.color = val > 5 ? "var(--neon-red)" : "var(--neon-gold)";
    });

    /* --- FILE PREVIEW LOGIC (NEW) --- */
    fileField.addEventListener('change', function(e) {
        const file = e.target.files[0];
        if(file) {
            // Create FileReader to preview image
            const reader = new FileReader();
            reader.onload = function(event) {
                // Set the background image of the label
                fileUi.style.backgroundImage = `url('${event.target.result}')`;
                // Add class to hide text and change border style
                fileUi.classList.add('preview-active');
            }
            reader.readAsDataURL(file);
        }
    });

    /* --- SUBMIT LOGIC --- */
    triggerBtn.addEventListener('click', async () => {
        const name = nameField.value;
        const category = catField.value; // NEW
        const condition = condField.value;
        const age = ageField.value;
        const file = fileField.files[0];

        if(!name || !file || !category) {
             // Simple shake animation on error
             const deck = document.querySelector('.holodeck');
             deck.style.transform = "translateX(10px)";
             setTimeout(()=> deck.style.transform = "translateX(0px)", 100);
             alert("ALERT: REQUIRED DATA MISSING (Name, Category, or Image)");
             return;
        }

        triggerBtn.disabled = true;
        triggerBtn.textContent = "ANALYZING DATA STREAMS...";
        setGauge(0.02); // Show a little activity
        priceOut.textContent = "---";

        const form = new FormData();
        form.append('product_name', name);
        form.append('category', category);   // NEW
        form.append('condition', condition);
        form.append('age', age);
        form.append('file', file);

        try {
            const req = await fetch(`${SERVER_URL}/predict`, {
                method: 'POST',
                body: form
            });

            if(req.ok) {
                const res = await req.json();
                triggerBtn.textContent = "ESTIMATION COMPLETE";
                
                countUp(priceOut, 0, res.predicted_price, 2000);
                
                let ratio = res.predicted_price / MAX_VAL;
                if(ratio > 1) ratio = 1;
                if(ratio < 0.05 && res.predicted_price > 0) ratio = 0.05; // Min visual for low prices
                setTimeout(() => setGauge(ratio), 100);
            } else {
                throw new Error("API Failure");
            }
        } catch (e) {
            alert("SYSTEM FAILURE: UNABLE TO CONNECT TO QWEN MAINFRAME");
            triggerBtn.textContent = "RETRY CONNECTION";
            setGauge(0);
        } finally {
            triggerBtn.disabled = false;
        }
    });

    function countUp(el, start, end, duration) {
        let startTime = null;
        const step = (ts) => {
            if (!startTime) startTime = ts;
            const progress = Math.min((ts - startTime) / duration, 1);
            const ease = 1 - Math.pow(1 - progress, 4);
            el.textContent = Math.floor(start + (end - start) * ease).toLocaleString();
            if (progress < 1) window.requestAnimationFrame(step);
        };
        window.requestAnimationFrame(step);
    }
</script>
</body>
</html>